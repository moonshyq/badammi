<!DOCTYPE html>
<!--[if IE 7]><html class="no-js ie7 oldie" lang="en-US"> <![endif]-->
<!--[if IE 8]><html class="no-js ie8 oldie" lang="en-US"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="agency, ecommerce">
        <meta name="author" content="Md. Siful Islam, Jtheme">

        <title>Badammi</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
        <link rel="shortcut icon" href="assets/ico/favicon.ico">

        <!-- Font Icon -->
        <link href="assets/css/plugin/font-awesome.min.css" rel="stylesheet" type="text/css">  

        <!-- CSS Global -->
        <link href="assets/css/plugin/bootstrap.min.css" rel="stylesheet" type="text/css">  
        <link href="assets/css/plugin/bootstrap-select.min.css" rel="stylesheet" type="text/css"> 
        <link href="assets/css/plugin/owl.carousel.css" rel="stylesheet" type="text/css">
        <link href="assets/css/plugin/animate.css" rel="stylesheet" type="text/css"> 
        <link href="assets/css/plugin/jquery-ui.min.css" rel="stylesheet" type="text/css"> 

        <!-- Custom CSS -->
        <link href="assets/css/theme.css" rel="stylesheet" type="text/css">

        <!-- Color CSS --> 

        <!--[if lt IE 9]>
        <script src="assets/js/plugin/html5shiv.js"></script>
        <script src="assets/js/plugin/respond.js"></script>
        <![endif]-->        
    </head>

    <body id="home" class="wide">

        <!-- WRAPPER -->
        <main class="wrapper"> 
            <!-- CONTENT AREA -->

            <!-- Main Header Start -->
            <header class="main-header white-bg">                  
                <div class="container-fluid rel-div">
                    <div class="col-lg-4 col-sm-8">
                        <div class="main-logo">
                            <a href="index.html"> <img alt="" src="assets/img/logo/main-logo.png" />  </a>
                            <span class="medium-font">ORGANIC STORE</span>
                        </div>
                    </div>

                   <div class="col-lg-6 responsive-menu">  
                        <div class="responsive-toggle fa fa-bars"> </div>
                        <nav class="fix-navbar" id="primary-navigation">            
                            <ul class="primary-navbar">                                                
                                <li class="dropdown active">
                                    <a href="index.html">Home</a>                                            
                                </li> 
                                <li><a href="about-us.html">About Us</a></li>
                                <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" >Fresh products</a> 
                                    <ul id="fresh"class="dropdown-menu"> </ul> 
                                </li>
                                <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" >Dried products</a> 
                                    <ul class="dropdown-menu"> </ul> 
                                </li>  
                                <li><a href="contact.html">Contact Us</a></li>   
                                        </li> 
                                    </ul>
                                </li>
                            </ul>                           
                        </nav>
                    </div>
                    <div class="responsive-toggle fa fa-bars"> </div>
                </div>  
            </header>
            <!-- / Main Header Ends -->   

            <!--Breadcrumb Section Start-->
            <section class="breadcrumb-bg">                
                <div class="theme-container container ">                       
                    <div class="site-breadcumb white-clr">                        
                        <h2 class="section-title"> <strong class="clr-txt">naturix </strong> <span class="light-font">Shop </span> </h2>
                        <ol class="breadcrumb breadcrumb-menubar">
                            <li> <a href="index.html"> Home </a> SHOP  </li>                             
                        </ol>
                    </div>  
                </div>
            </section>
            <!--Breadcrumb Section End-->


            <!-- Shop Starts-->
            <section class="shop-wrap sec-space-bottom">
                <div class="container rel-div pt-50">
                    <div class="row">
                        <div class="col-md-9 pt-15">                          
                            <div class="product-single sec-space-bottom  clearfix">
                                <div class="col-lg-6 pb-50 col-sm-8 col-sm-offset-2 col-lg-offset-0">
                                    <div class="prod-slider sync1">
                                    </div>

                                <div class="sync2-container">
                                    <div class="sync2 owl-carousel"></div>
                                </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="product-content block-inline">
                                        <div class="single-caption"> 
                                            <h3 class="section-title">
                                                <a href="#"> <span class="light-font"> organic </span>  <strong id="fruit-name">Название</strong></a>
                                            </h3>
                                            <span class="divider-2"></span>
                                            <div class="fsz-16">
                                                <p><strong>Composition:</strong> </p>
                                                <p id="fruit-description"></p>
                                            </div>
                                            <div class="fsz-16">
                                                <p><strong>Benefits:</strong></p>
                                                <ul id="fruit-benefits"></ul>
                                            </div>
                                        </div>
                                    </div>
                                </div> 
                            </div>  

            </section>
            <!-- / Shop Ends -->      

            <!-- / CONTENT AREA -->

            <!-- FOOTER -->
            <footer class="page-footer"> 
                <section class="sec-space light-bg">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-3 col-sm-12 footer-widget">
                                <div class="main-logo">
                                    <a href="index.html"> <img alt="" src="assets/img/logo/main-logo.png" />  </a>
                                    <span class="medium-font">ORGANIC STORE</span>
                                </div>
                                <span class="divider-2"></span>
                                <div class="text-widget">
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna.</p>
                                    <ul>
                                        <li> <i class="fa fa-map-marker"></i> <span> <strong>100 highland ave,</strong> california, united state </span> </li>
                                        <li> <i class="fa fa-envelope-square"></i> <span><a href="#">contact@naturix.com</a> </span> </li>
                                        <li> <i class="fa fa-phone-square"></i> <span><a href="#">www.naturix.com</a> </span> </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-4 footer-widget">
                                <h2 class="title-1">  <span class="light-font">naturix  </span> <strong>information </strong> </h2>
                                <span class="divider-2"></span>
                                <ul class="list">
                                    <li> <a href="#"> about our shop </a> </li>
                                    <li> <a href="#"> our blog </a> </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
                
            </footer>
            <!-- /FOOTER -->

<div id="to-top-mb" class="to-top mb"> <i class="fa fa-arrow-circle-o-up"></i> </div>

        </main>
        <!-- /WRAPPER -->

        <!-- JS Global -->
        <script src="assets/js/plugin/jquery-2.2.4.min.js"></script>   
        <script src="assets/js/plugin/bootstrap.min.js"></script>
        <script src="assets/js/plugin/bootstrap-select.min.js"></script>       
        <script src="assets/js/plugin/owl.carousel.min.js"></script>
        <script src="assets/js/plugin/jquery-ui.min.js"></script>

        <!-- Custom JS -->   
        <script src="assets/js/theme.js"></script>


<script>
$(document).ready(function () {
    async function loadFruit() {
        try {
            const fruitId = new URLSearchParams(window.location.search).get("id");
            if (!fruitId) return console.warn("❌ Id не найден в URL");

            const apiUrl = `http://localhost:8080/Fruits/ShopOne?id=${fruitId}`;
            const response = await fetch(apiUrl, { headers: { "ngrok-skip-browser-warning": "true" } });
            if (!response.ok) throw new Error("Ошибка загрузки данных: " + response.status);
            const fruit = await response.json();

            $("#fruit-name").text(fruit.name);
            $("#fruit-description").text(fruit.composition);

            const mainSlider = $(".prod-slider.sync1");
            const thumbSlider = $(".sync2");
            mainSlider.empty();
            thumbSlider.empty();

            const mainImgUrl = `http://localhost:8080/photos/${fruit.id}.png`;
            const thumbnails = [mainImgUrl];

            if (fruit.childPhotoPath && fruit.childPhotoPath.length > 0) {
                fruit.childPhotoPath.forEach((_, index) => {
                    const imgUrl = `http://localhost:8080/photos/${fruit.id}_${index + 1}.png`;
                    thumbnails.push(imgUrl);
                });
            }

            // --- Главная фотка ---
            mainSlider.append(`
                <div class="item active">
                    <img id="main-photo" src="${mainImgUrl}" alt="${fruit.name}" style="width:350px;height:auto;object-fit:cover;border-radius:8px;cursor:grab;">
                </div>
            `);

            // --- Миниатюры ---
            thumbnails.forEach((url, i) => {
                thumbSlider.append(`
                    <div class="item thumb" data-index="${i}">
                        <img src="${url}" alt="thumb ${i}" style="width:80px;height:80px;object-fit:cover;border:2px solid ${i===0?'#6ab04c':'transparent'};border-radius:6px;cursor:pointer;">
                    </div>
                `);
            });

            // --- Преимущества ---
            const benefitsList = $("#fruit-benefits");
            benefitsList.empty();
            if (fruit.benefits && fruit.benefits.length > 0) {
                fruit.benefits.forEach(benefit => benefitsList.append(`<li>${benefit}</li>`));
            }

            // --- Инициализация Owl Carousel ---
            mainSlider.owlCarousel({ items: 1, loop: false, dots: false, nav: true, navText: ["<",">"], smartSpeed: 500 });
           thumbSlider.owlCarousel({
    items: 5,
    margin: 10,
    dots: false,
    nav: true,          // включаем кнопки
    navText: ["<",">"], // текст кнопок
    smartSpeed: 500,
    slideBy: 1,
    loop: false         // если нужно бесконечное листание, ставим true
});

            // --- Функция обновления главного фото ---
            function updateMainPhoto(index) {
    const newSrc = thumbnails[index];
    const mainPhoto = $("#main-photo");

    // Сначала делаем fade out
    mainPhoto.css("opacity", "0");

    setTimeout(() => {
        mainPhoto.attr("src", newSrc);
        mainPhoto.css("opacity", "1"); // плавный fade in
    }, 200); // половина времени перехода
     
    $(".sync2 .item img").css("border", "2px solid transparent");
    $(".sync2 .item").eq(index).find("img").css("border", "2px solid #6ab04c");
}

            // --- Клик по миниатюрам ---
            $(".sync2 .item img").on("click", function () {
                const index = $(this).parent().data("index");
                updateMainPhoto(index);
            });

            // --- Drag / swipe главной фотографии ---
            let startX = 0;
            let endX = 0;
            const mainPhoto = document.getElementById("main-photo");
            if (mainPhoto) {
            mainPhoto.ondragstart = () => false;
            }

            function handleDrag() {
                const diff = endX - startX;
                let currentIndex = thumbnails.indexOf($("#main-photo").attr("src"));

                if (diff > 30) currentIndex = Math.max(currentIndex - 1, 0);
                else if (diff < -30) currentIndex = Math.min(currentIndex + 1, thumbnails.length - 1);

                updateMainPhoto(currentIndex);
            }

            mainPhoto.addEventListener("mousedown", e => startX = e.clientX);
            mainPhoto.addEventListener("mouseup", e => { endX = e.clientX; handleDrag(); });
            mainPhoto.addEventListener("touchstart", e => startX = e.touches[0].clientX);
            mainPhoto.addEventListener("touchend", e => { endX = e.changedTouches[0].clientX; handleDrag(); });

        } catch (error) {
            console.error("Ошибка при загрузке фрукта:", error);
            $("#fruit-name").text("Не удалось загрузить фрукт");
            $("#fruit-description").text("");
        }
    }

    loadFruit();
});

// === Загрузка всех фруктов для меню ===
document.addEventListener("DOMContentLoaded", async () => {
    const apiUrl = "http://localhost:8080/Fruits/GetAllFruits";

    try {
        const response = await fetch(apiUrl, { headers: { "ngrok-skip-browser-warning": "true" } });
        if (!response.ok) throw new Error("Ошибка загрузки API");
        const fruits = await response.json();

        // --- Dried Products ---
        const driedDropdown = Array.from(document.querySelectorAll(".primary-navbar .dropdown")).find(drop => 
            drop.querySelector("a")?.textContent.toLowerCase().includes("dried products")
        );
        if (driedDropdown) {
            let driedMenu = driedDropdown.querySelector(".dropdown-menu");
            if (!driedMenu) { driedMenu = document.createElement("ul"); driedMenu.classList.add("dropdown-menu"); driedDropdown.appendChild(driedMenu); }
            driedMenu.innerHTML = "";
            fruits.filter(f => f.name.toLowerCase().includes("dried")).forEach(fruit => {
                const li = document.createElement("li");
                li.innerHTML = `<a class="fix-a" href="shop-single.html?id=${fruit.id}">${fruit.name}</a>`;
                driedMenu.appendChild(li);
            });
            driedMenu.innerHTML += `<li><a class="fix-a" href="shop-2.html"><strong>All catalog</strong></a></li>`;
        }

        // --- Fresh Products ---
        const freshMenu = document.getElementById("fresh");
        if (freshMenu) {
            freshMenu.innerHTML = "";
            fruits.filter(f => !f.name.toLowerCase().includes("dried")).forEach(fruit => {
                const li = document.createElement("li");
                li.innerHTML = `<a class="fix-a" href="shop-single.html?id=${fruit.id}">${fruit.name}</a>`;
                freshMenu.appendChild(li);
            });
            freshMenu.innerHTML += `<li><a class="fix-a" href="shop-1.html"><strong>All catalog</strong></a></li>`;
        }

    } catch (err) {
        console.error("Ошибка при загрузке фруктов:", err);
    }
});
</script>
 
<style>
  .sync2-container {
    position: relative;
}

.sync2 .owl-nav {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    transform: translateY(-50%);
    pointer-events: none; /* Чтобы кнопки не перекрывались миниатюрами */
    z-index: 10;
}

.sync2 .owl-nav button {
    pointer-events: all;
    background: #6ab04c;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    opacity: 1;
}

.sync2 {
    display: flex;
    align-items: center;
    justify-content: flex-start;
     overflow: visible !important;
}

.sync2 .item {
    margin-right: 10px;
}

.sync2 .owl-nav {
    display: flex;
    justify-content: space-between;
    width: 100%;
}

.sync2 .owl-nav button {
    background: #6ab04c;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}
#main-photo {
    transition: transform 0.4s ease, opacity 0.4s ease;
}
</style>
    </body>
</html>